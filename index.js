(()=>{function a(e){let o="",t=new Uint8Array(e),n=t.byteLength;for(let i=0;i<n;i++)o+=String.fromCharCode(t[i]);return window.btoa(o)}function c(e){let o=e.replace(/-/g,"+").replace(/_/g,"/");return o+="=".repeat((4-o.length%4)%4),Uint8Array.from(atob(o),t=>t.charCodeAt(0)).buffer}var R={data(){return{passkeys:[]}},props:{label:String},async created(){let e=await this.load();this.passkeys=e.passkeys},methods:{async registerNew(){let e=await this.$api.get("passkeys/create/args");e.publicKey.challenge=c(e.publicKey?.challenge),e.publicKey.allowCredentials=e.publicKey?.allowCredentials?.map(n=>(n.id=c(n.id),n)),e.publicKey.excludeCredentials=e.publicKey?.excludeCredentials?.map(n=>(n.id=c(n.id),n)),e.publicKey.user.id=c(e.publicKey?.user?.id);let t=(await navigator.credentials.create(e))?.response;if(t?.clientDataJSON){let n=a(t.clientDataJSON),i=a(t.attestationObject),l=await this.$api.post("passkeys/create/process",{clientData:n,attestationObject:i});this.passkeys=l.passkeys}}}},u=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("section",{staticClass:"k-passkey-section",attrs:{label:e.label}},[t("header",{staticClass:"k-section-header"},[t("k-headline",[e._v(e._s(e.label))]),e._v(" "),e.$view.id==="account"?t("k-button-group",{attrs:{buttons:[{text:"Register new",click:e.registerNew,icon:"touch"}]}}):e._e()],1),e._v(" "),t("div",[e.passkeys.length?t("div",[t("k-items",{attrs:{items:e.passkeys.map(function(n){return Object.assign({},n,{options:[]})}),columns:{rpId:{label:"Relying Party",type:"text"},credentialId:{label:"Credential ID",type:"text"}},layout:"table"}})],1):t("div",[t("k-empty",[e._v("No passkeys yet.")])],1)])])},L=[];u._withStripped=!0;var $=void 0,I=void 0,j=void 0,K=!1;function T(e,o,t,n,i,l,g,v,x,b){let s=(typeof t=="function"?t.options:t)||{};return s.__file="src/components/AccountView.vue",s.render||(s.render=e.render,s.staticRenderFns=e.staticRenderFns,s._compiled=!0,i&&(s.functional=!0)),s._scopeId=n,s}var A=T({render:u,staticRenderFns:L},$,R,I,K,j,!1,void 0,void 0,void 0),_=A;var V={data(){return{user:{email:""}}},computed:{resident(){return h},fields(){return this.resident?{}:{email:{type:"email",required:!1,label:this.$t("email"),icon:"user",autocomplete:"email"}}}},methods:{cancel(){this.$emit("cancel")},async submit(){let e=await this.$api.get("passkeys/get/args");e.publicKey.challenge=c(e.publicKey.challenge);try{let o=await navigator.credentials.get(e),t=o.response,n={id:o.rawId?a(o.rawId):null,clientDataJSON:t.clientDataJSON?a(t.clientDataJSON):null,authenticatorData:t.authenticatorData?a(t.authenticatorData):null,signature:t.signature?a(t.signature):null,userHandle:t.userHandle?a(t.userHandle):null};(await this.$api.post("passkeys/get/process",{email:this.user.email,response:n}))?.success&&this.$reload({globals:["$system","$translation"]})}catch(o){console.log(o);return}}}},p=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("form",{staticClass:"k-login-with-passkey",on:{submit:function(n){return n.preventDefault(),e.submit.apply(null,arguments)}}},[t("k-fieldset",{attrs:{novalidate:!0,fields:e.fields},model:{value:e.user,callback:function(n){e.user=n},expression:"user"}}),e._v(" "),e.resident?t("div",{staticStyle:{display:"flex"}},[t("button",{staticClass:"rs-passkey-button",attrs:{type:"submit"}},[t("k-icon",{attrs:{type:"touch"}}),e._v(`Login with Passkey
    `)],1)]):e._e(),e._v(" "),t("div",{staticClass:"k-login-buttons"},[t("k-button",{attrs:{icon:"cancel",type:"button"},on:{click:function(n){return e.$emit("cancel")}}},[e._v("Login with password")]),e._v(" "),e.resident?e._e():t("k-button",{staticClass:"k-login-button",attrs:{icon:"touch",type:"submit"}},[e._v(e._s(e.$t("login")))])],1)],1)},O=[];p._withStripped=!0;var N=void 0,P=void 0,D=void 0,B=!1;function E(e,o,t,n,i,l,g,v,x,b){let s=(typeof t=="function"?t.options:t)||{};return s.__file="src/components/LoginWithPasskey.vue",s.render||(s.render=e.render,s.staticRenderFns=e.staticRenderFns,s._compiled=!0,i&&(s.functional=!0)),s._scopeId=n,s}var M=E({render:p,staticRenderFns:O},N,V,P,B,D,!1,void 0,void 0,void 0),f=M;var y={props:{methods:Array},data(){return{showPassword:!1}},render(e){return e("div",[this.showPassword?e("div",[e(d,{props:{methods:this.methods}}),e("hr"),e("k-button",{props:{icon:"touch"},on:{click:()=>this.showPassword=!1}},["Use Passkey"])]):e(f,{on:{cancel:()=>this.showPassword=!0}})])}};var m='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17.0003 13V14C17.0003 16.7696 16.3364 19.445 15.0853 21.8455L14.8585 22.2663L13.1116 21.2924C14.2716 19.2115 14.9211 16.8817 14.9935 14.4559L15.0003 14V13H17.0003ZM11.0003 10H13.0003V14L12.9948 14.3787C12.9153 17.1495 11.9645 19.7731 10.3038 21.928L10.073 22.2189L8.52406 20.9536C10.0408 19.0969 10.9145 16.8017 10.9943 14.3663L11.0003 14V10ZM12.0003 6C14.7617 6 17.0003 8.23858 17.0003 11H15.0003C15.0003 9.34315 13.6571 8 12.0003 8C10.3434 8 9.00025 9.34315 9.00025 11V14C9.00025 16.2354 8.1806 18.3444 6.72928 19.9768L6.51767 20.2067L5.06955 18.8273C6.23328 17.6056 6.92099 16.0118 6.99381 14.3027L7.00025 14V11C7.00025 8.23858 9.23883 6 12.0003 6ZM12.0003 2C16.9708 2 21.0003 6.02944 21.0003 11V14C21.0003 15.6979 20.7985 17.3699 20.4035 18.9903L20.2647 19.5285L18.3349 19.0032C18.726 17.5662 18.9475 16.0808 18.9919 14.5684L19.0003 14V11C19.0003 7.13401 15.8662 4 12.0003 4C10.4279 4 8.97663 4.51841 7.80805 5.39364L6.38308 3.96769C7.92267 2.73631 9.87547 2 12.0003 2ZM4.96794 5.38282L6.39389 6.8078C5.5635 7.91652 5.0543 9.27971 5.00431 10.7593L4.99961 10.999L5.00378 13C5.00378 14.1195 4.73991 15.2026 4.24263 16.1772L4.08648 16.4663L2.34961 15.4747C2.72889 14.8103 2.95077 14.0681 2.99539 13.2924L3.00378 13L3.00361 11C3.00025 8.87522 3.73656 6.92242 4.96794 5.38282Z"></path></svg>';var h=!0,d=null;panel.plugin("rasteiner/k3-passkeys",{use:[e=>{d=e.component("k-login")}],sections:{passkey:_},icons:{touch:m},login:y});})();
