(()=>{function a(e){let o="",t=new Uint8Array(e),n=t.byteLength;for(let i=0;i<n;i++)o+=String.fromCharCode(t[i]);return window.btoa(o)}function c(e){let o=e.replace(/-/g,"+").replace(/_/g,"/");return o+="=".repeat((4-o.length%4)%4),Uint8Array.from(atob(o),t=>t.charCodeAt(0)).buffer}var R={data(){return{passkeys:[]}},props:{label:String},async created(){let e=await this.load();this.passkeys=e.passkeys},methods:{async registerNew(){let e=await this.$api.get("passkeys/create/args");e.publicKey.challenge=c(e.publicKey?.challenge),e.publicKey.allowCredentials=e.publicKey?.allowCredentials?.map(n=>(n.id=c(n.id),n)),e.publicKey.excludeCredentials=e.publicKey?.excludeCredentials?.map(n=>(n.id=c(n.id),n)),e.publicKey.user.id=c(e.publicKey?.user?.id);let t=(await navigator.credentials.create(e))?.response;if(t?.clientDataJSON){let n=a(t.clientDataJSON),i=a(t.attestationObject),l=await this.$api.post("passkeys/create/process",{clientData:n,attestationObject:i});this.passkeys=l.passkeys}}}},u=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("section",{staticClass:"k-passkey-section",attrs:{label:e.label}},[t("header",{staticClass:"k-section-header"},[t("k-headline",[e._v(e._s(e.label))]),e._v(" "),e.$view.id==="account"?t("k-button-group",{attrs:{buttons:[{text:"Register new",click:e.registerNew,icon:"touch"}]}}):e._e()],1),e._v(" "),t("div",[e.passkeys.length?t("div",[t("k-items",{attrs:{items:e.passkeys,columns:{rpId:{label:"Relying Party",type:"text"},credentialId:{label:"Credential ID",type:"text"}},layout:"table"}})],1):t("div",[t("k-empty",[e._v("No passkeys yet.")])],1)])])},$=[];u._withStripped=!0;var I=void 0,j=void 0,A=void 0,K=!1;function T(e,o,t,n,i,l,g,v,k,x){let s=(typeof t=="function"?t.options:t)||{};return s.__file="src/components/AccountView.vue",s.render||(s.render=e.render,s.staticRenderFns=e.staticRenderFns,s._compiled=!0,i&&(s.functional=!0)),s._scopeId=n,s}var N=T({render:u,staticRenderFns:$},I,R,j,K,A,!1,void 0,void 0,void 0),_=N;var O={data(){return{user:{email:""}}},computed:{resident(){return h},fields(){return this.resident?{}:{email:{type:"email",required:!1,label:this.$t("email"),icon:"user",autocomplete:"email"}}}},methods:{cancel(){this.$emit("cancel")},async submit(){let e=await this.$api.get("passkeys/get/args");e.publicKey.challenge=c(e.publicKey.challenge);try{let o=await navigator.credentials.get(e),t=o.response,n={id:o.rawId?a(o.rawId):null,clientDataJSON:t.clientDataJSON?a(t.clientDataJSON):null,authenticatorData:t.authenticatorData?a(t.authenticatorData):null,signature:t.signature?a(t.signature):null,userHandle:t.userHandle?a(t.userHandle):null};(await this.$api.post("passkeys/get/process",{email:this.user.email,response:n}))?.success&&this.$reload({globals:["$system","$translation"]})}catch(o){console.log(o);return}}}},p=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("form",{staticClass:"k-login-with-passkey",on:{submit:function(n){return n.preventDefault(),e.submit.apply(null,arguments)}}},[t("k-fieldset",{attrs:{novalidate:!0,fields:e.fields},model:{value:e.user,callback:function(n){e.user=n},expression:"user"}}),e._v(" "),e.resident?t("div",{staticStyle:{display:"flex"}},[t("button",{staticClass:"rs-passkey-button",attrs:{type:"submit"}},[t("k-icon",{attrs:{type:"touch"}}),e._v(`Login with Passkey
    `)],1)]):e._e(),e._v(" "),t("div",{staticClass:"k-login-buttons"},[t("k-button",{attrs:{icon:"cancel",type:"button"},on:{click:function(n){return e.$emit("cancel")}}},[e._v("Login with password")]),e._v(" "),e.resident?e._e():t("k-button",{staticClass:"k-login-button",attrs:{icon:"touch",type:"submit"}},[e._v(e._s(e.$t("login")))])],1)],1)},P=[];p._withStripped=!0;var D=void 0,E=void 0,B=void 0,F=!1;function L(e,o,t,n,i,l,g,v,k,x){let s=(typeof t=="function"?t.options:t)||{};return s.__file="src/components/LoginWithPasskey.vue",s.render||(s.render=e.render,s.staticRenderFns=e.staticRenderFns,s._compiled=!0,i&&(s.functional=!0)),s._scopeId=n,s}var U=L({render:p,staticRenderFns:P},D,O,E,F,B,!1,void 0,void 0,void 0),f=U;var y={props:{methods:Array},data(){return{showPassword:!1}},render(e){return e("div",[this.showPassword?e("div",[e(d,{props:{methods:this.methods}}),e("hr"),e("k-button",{props:{icon:"touch"},on:{click:()=>this.showPassword=!1}},["Use Passkey"])]):e(f,{on:{cancel:()=>this.showPassword=!0}})])}};var m='<g stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" transform="translate(0 0.5)"><path d="M5.5,15.5V7A2.5,2.5,0,0,1,8,4.5H8A2.5,2.5,0,0,1,10.5,7v8.5"></path> <path d="M2.876,11a6.5,6.5,0,1,1,10.248,0"></path> <line x1="7.5" y1="8.5" x2="8.5" y2="8.5"></line></g>';var h=!0,d=null;panel.plugin("rasteiner/k3-passkeys",{use:[e=>{d=e.component("k-login")}],sections:{passkey:_},icons:{touch:m},login:y});})();
